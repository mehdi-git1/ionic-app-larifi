<ion-header>
    <ion-toolbar>
        <ion-back-button color="white" slot="start"></ion-back-button>
        <page-header [showSettingsIcon]="true" [pnc]="pnc">
            <span *ngIf="pnc"> {{ 'GLOBAL.BUSINESS_INDICATORS' | isMyPage: pnc | translate }}</span>
        </page-header>
    </ion-toolbar>
    <pnc-edossier-header [activeTab]="TabHeaderEnum.BUSINESS_INDICATORS_PAGE"></pnc-edossier-header>
</ion-header>
<ion-content>
    <div class="page-container">
        <edossier-spinner *ngIf="!loadingIsOver(); else pageBlock"></edossier-spinner>
        <ng-template #pageBlock>
            <h3 class="summary-title">{{ 'BUSINESS_INDICATORS.PAST_SUMMARY.TITLE' | translate }}</h3>
            <ion-card class="summary">
                <ion-card-content>
                    <div class="summary-item">
                        <label>{{ 'BUSINESS_INDICATORS.PAST_SUMMARY.ESCORE_AVERAGE' | translate }}</label>
                        <div>
                            <img class="file-icon" src="assets/imgs/business-indicators/e-score.svg" />
                            <span class="summary-value">{{ businessIndicator?.escoreAverage | number : '1.0-1' }}</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <label>{{ 'BUSINESS_INDICATORS.PAST_SUMMARY.FLYING_BLUE_ERC_AVERAGE' | translate }}</label>
                        <div>
                            <img class="file-icon" src="assets/imgs/business-indicators/fb-erc.svg" />
                            <span class="summary-value">{{ businessIndicator?.flyingBlueAndERCAverage | number : '1.0-1' }}</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <label>{{ 'BUSINESS_INDICATORS.PAST_SUMMARY.UPGRADE_AVERAGE' | translate }}</label>
                        <div>
                            <img class="file-icon" src="assets/imgs/business-indicators/upgrade.svg" />
                            <span class="summary-value">{{ businessIndicator?.upgradeAverage | number : '1.0-1' }}</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <label>{{ 'BUSINESS_INDICATORS.PAST_SUMMARY.ON_TIME_SHUTTLE_DEPARTURE_RATIO' | translate }}</label>
                        <div>
                            <img class="file-icon" src="assets/imgs/business-indicators/shuttle-departure.svg" />
                            <span class="summary-value">{{ businessIndicator?.onTimeShuttleDepartureRatio | percent : '1.0-1' }}</span>
                        </div>
                    </div>
                </ion-card-content>
            </ion-card>

            <h3 class="flight-list-title">{{ 'BUSINESS_INDICATORS.FLIGHT_CARD_12_LAST_MONTHS' | translate }}</h3>
            <div class="mat-elevation-z8">
                <table mat-table matSort matSortActive="flightDate" matSortDirection="desc" (matSortChange)="sortFlightCards($event)" [dataSource]="dataSource" class="flight-cards-table mat-elevation-z8">
                    <ng-container matColumnDef="flightNumber">
                        <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ 'BUSINESS_INDICATORS.FLIGHT_NUMBER' | translate }}</th>
                        <td mat-cell *matCellDef="let flightDetailsCard">{{ 'GLOBAL.AF_COMPANY' | translate}}{{flightDetailsCard.flightNumber }}</td>
                    </ng-container>
                    <ng-container matColumnDef="flightDate">
                        <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ 'BUSINESS_INDICATORS.LEG_DATE' | translate }}</th>
                        <td mat-cell *matCellDef="let flightDetailsCard" class="suffix-tu">{{ flightDetailsCard.plannedDepartureDate | date : 'dd/MM/yyyy HH:mm':'UTC' }}</td>
                    </ng-container>
                    <ng-container matColumnDef="stations">
                        <th mat-header-cell *matHeaderCellDef>{{ 'BUSINESS_INDICATORS.STATIONS' | translate }}</th>
                        <td mat-cell *matCellDef="let flightDetailsCard">{{ flightDetailsCard.departureStation }} - {{ flightDetailsCard.arrivalStation }}</td>
                    </ng-container>
                    <ng-container matColumnDef="eScore">
                        <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ 'BUSINESS_INDICATORS.ESCORE' | translate }}</th>
                        <td mat-cell *matCellDef="let flightDetailsCard">
                            <span [class.no-data]="!flightDetailsCard.escore">{{ flightDetailsCard.escore | number :'1.0-1' }}</span>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="flightActionsNumber">
                        <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ 'BUSINESS_INDICATORS.FLIGHT_ACTIONS_NUMBER' | translate }}</th>
                        <td mat-cell *matCellDef="let flightDetailsCard" class="flight-actions-number">
                            <span [class.no-data]="!flightDetailsCard.flightActionsTotalNumber"></span>
                            <span *ngIf="flightDetailsCard.flightActionsTotalNumber">{{ flightDetailsCard.flightActionsTotalNumber }}</span>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="flightCardsColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: flightCardsColumns;" (click)="goToFlightDetailsCard(row)"></tr>
                </table>
                <mat-paginator color="black" [pageSize]="pageSize" [length]=" this.sortedFlightCards.length" (page)="handlePage($event)" showFirstLastButtons></mat-paginator>
            </div>
        </ng-template>
    </div>
</ion-content>
