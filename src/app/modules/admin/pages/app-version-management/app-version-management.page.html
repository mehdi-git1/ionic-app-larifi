<ion-header>
    <ion-navbar>
        <ion-title>{{ 'ADMIN.APP_VERSION_MANAGEMENT.TITLE' | translate }}</ion-title>
    </ion-navbar>
    <tab-header [mode]="TabHeaderModeEnum.ADMIN"></tab-header>
</ion-header>

<ion-content padding>
    <ion-grid>
        <!-- Formulaire de création de version -->
        <form>
            <ion-row nowrap>
                <ion-col col-3>
                    <ion-item>
                        <ion-label floating>{{ 'ADMIN.APP_VERSION_MANAGEMENT.LABEL.VERSION_NUMBER' | translate }}
                        </ion-label>
                        <ion-input type="text" name="number" [(ngModel)]="number" required>
                        </ion-input>
                    </ion-item>
                    <ion-label>{{ 'ADMIN.APP_VERSION_MANAGEMENT.LABEL.RELEASE_DATE' | translate }}</ion-label>
                    <ion-item>
                        <ion-label>
                            <ion-icon name="calendar"></ion-icon>
                        </ion-label>
                        <ion-datetime displayFormat="DD/MM/YYYY" pickerFormat="DD MMMM YYYY" name="releaseDate" [(ngModel)]="releaseDate" [doneText]="translateService.instant('GLOBAL.DATEPICKER.DONE')" [cancelText]="translateService.instant('GLOBAL.DATEPICKER.CANCEL')" [max]="datepickerMaxDate" [monthNames]="monthsNames"></ion-datetime>
                    </ion-item>
                </ion-col>
                <ion-col col-7>
                    <ion-item (click)="editAppVersion()">
                        <text-editor [content]="changelog" name="changelog" (contentFromChild)="setContent($event)"></text-editor>
                    </ion-item>
                </ion-col>
                <ion-col class="submit-button" col-2>
                    <ion-item>
                        <button ion-button color="blue60" class="changelog-button" (click)="createOrUpdateAppVersion()">
                            <ion-icon name="md-add" ios="md-add" margin-right></ion-icon>
                            {{ 'ADMIN.APP_VERSION_MANAGEMENT.BUTTON.ADD_VERSION' | translate }}
                        </button>
                    </ion-item>
                </ion-col>
            </ion-row>
        </form>
        <ion-row nowrap>
            <!-- Header du tableau -->
            <mat-expansion-panel id="matExpansionPanelAppVersion" class="title" [expanded]="true">
                <edossier-spinner *ngIf="allAppVersions == undefined; else appVersionsDataBlock "></edossier-spinner>
                <!-- Liste des versions -->
                <ng-template #appVersionsDataBlock>
                    <mat-expansion-panel class="app-version-list" *ngFor=" let appVersion of allAppVersions">
                        <mat-expansion-panel-header class="app-version" [expandedHeight]="matPanelHeaderHeight" [collapsedHeight]="matPanelHeaderHeight" hideToggle="true">
                            <ion-grid>
                                <ion-row>
                                    <ion-col col-10>
                                        <label class="app-version-number">{{ appVersion.number}}</label>
                                    </ion-col>
                                    <ion-col col-2>
                                        <div class="expansion-button-placeholder">
                                            <!-- espace réservé au bouton d'ouverture qui disparait quand aucun écart de notation n'est présent -->
                                        </div>
                                    </ion-col>
                                </ion-row>
                            </ion-grid>
                        </mat-expansion-panel-header>
                        <!-- formulaire de modification d'une version -->
                        <ion-grid>
                            <form>
                                <ion-row>
                                    <ion-col col-3>
                                        <ion-item>
                                            <ion-label floating>{{ 'ADMIN.APP_VERSION_MANAGEMENT.LABEL.VERSION_NUMBER' | translate }}
                                            </ion-label>
                                            <ion-input type="text" name="modify-number" [(ngModel)]="appVersion.number" [value]="appVersion.number" required>
                                            </ion-input>
                                        </ion-item>
                                        <ion-label>{{ 'ADMIN.APP_VERSION_MANAGEMENT.LABEL.RELEASE_DATE' | translate }}</ion-label>
                                        <ion-item>
                                            <ion-label>
                                                <ion-icon name="calendar"></ion-icon>
                                            </ion-label>
                                            <ion-datetime displayFormat="DD/MM/YYYY" pickerFormat="DD MMMM YYYY" name="realeaseDate" [(ngModel)]="appVersion.releaseDate" [doneText]="translateService.instant('GLOBAL.DATEPICKER.DONE')" [cancelText]="translateService.instant('GLOBAL.DATEPICKER.CANCEL')" [max]="datepickerMaxDate" [monthNames]="monthsNames"></ion-datetime>
                                        </ion-item>
                                    </ion-col>
                                    <ion-col col-7>
                                        <ion-item (click)="editAppVersion(appVersion)">
                                            <text-editor [content]="appVersion.changelog" (contentFromChild)="setContent($event)"></text-editor>
                                        </ion-item>
                                    </ion-col>
                                    <ion-col col-2>
                                        <button ion-button color="blue60" name="modify-button" class="modify-button" (click)="createOrUpdateAppVersion(appVersion)">
                                            <ion-icon name="create" margin-right> </ion-icon>
                                            {{ 'ADMIN.APP_VERSION_MANAGEMENT.BUTTON.UPDATE_VERSION' | translate }}
                                        </button>
                                        <button ion-button color="red70" name="delete-button" class="delete-button" (click)="confirmDeleteAppVersion(appVersion)">
                                            <ion-icon name="ios-trash-outline" ios="ios-trash-outline" margin-right></ion-icon>
                                            {{ 'ADMIN.APP_VERSION_MANAGEMENT.BUTTON.DELETE_VERSION' | translate }}
                                        </button>
                                        <button ion-button color="orange55" class="overview-button" (click)="displayOverview(appVersion)">
                                            <ion-icon name="md-bug" ios="md-bug" margin-right></ion-icon>
                                            {{ 'ADMIN.APP_VERSION_MANAGEMENT.BUTTON.OVERVIEW' | translate }}
                                        </button>
                                    </ion-col>
                                </ion-row>
                            </form>
                        </ion-grid>
                    </mat-expansion-panel>
                </ng-template>
            </mat-expansion-panel>
        </ion-row>
    </ion-grid>
</ion-content>
